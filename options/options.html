<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>配置</title>
  <link rel="stylesheet" href="options.css">
</head>
<body>
  <div class="container">
    <h1>配置选项</h1>

    <section id="ai-config">
      <h2>AI 服务配置</h2>
      
      <!-- 主要供应商选择 -->
      <div class="form-group">
        <label for="ai-provider">主要AI服务商</label>
        <select id="ai-provider">
          <option value="google">Google (Gemini)</option>
          <option value="openai">OpenAI (GPT)</option>
          <option value="anthropic">Anthropic (Claude)</option>
        </select>
      </div>

      <!-- 供应商健康状态显示 -->
      <div class="form-group">
        <label>供应商状态</label>
        <div id="provider-status" class="provider-status-container">
          <!-- 动态生成的状态信息 -->
        </div>
        <button id="refresh-status-btn" type="button">刷新状态</button>
      </div>

      <!-- Google Gemini 配置 -->
      <div id="config-google" class="provider-config">
        <h3>Google Gemini 配置</h3>
        <div class="form-group">
          <label for="google-api-key">Gemini API Key</label>
          <div class="password-wrapper">
            <input type="password" id="google-api-key" placeholder="输入您的 Gemini API Key">
            <button type="button" class="toggle-visibility-btn" data-target="google-api-key">显示</button>
          </div>
          <small>获取API Key: <a href="https://makersuite.google.com/app/apikey" target="_blank">Google AI Studio</a></small>
        </div>
        <div class="form-group">
          <label for="google-model-name">模型名称</label>
          <input type="text" id="google-model-name" placeholder="输入模型名称，如：gemini-1.5-flash">
          <small>常用模型：gemini-1.5-flash, gemini-1.5-pro, gemini-1.0-pro</small>
        </div>
        <div class="form-group">
          <label for="google-api-url">API 请求路径</label>
          <input type="text" id="google-api-url" placeholder="输入API基础路径">
          <small>默认：https://generativelanguage.googleapis.com/v1beta/models</small>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" id="google-enabled"> 启用Google Gemini
          </label>
        </div>
        <button type="button" class="test-provider-btn" data-provider="google">测试 Gemini 连接</button>
      </div>

      <!-- OpenAI 配置 -->
      <div id="config-openai" class="provider-config" style="display: none;">
        <h3>OpenAI GPT 配置</h3>
        <div class="form-group">
          <label for="openai-api-key">OpenAI API Key</label>
          <input type="password" id="openai-api-key" placeholder="sk-...">
          <small>获取API Key: <a href="https://platform.openai.com/api-keys" target="_blank">OpenAI Platform</a></small>
        </div>
        <div class="form-group">
          <label for="openai-model-name">模型名称</label>
          <input type="text" id="openai-model-name" placeholder="输入模型名称，如：gpt-4o">
          <small>常用模型：gpt-4o, gpt-4o-mini, gpt-4-turbo, gpt-3.5-turbo</small>
        </div>
        <div class="form-group">
          <label for="openai-api-url">API 请求路径</label>
          <input type="text" id="openai-api-url" placeholder="输入API基础路径">
          <small>默认：https://api.openai.com/v1/chat/completions</small>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" id="openai-enabled"> 启用OpenAI GPT
          </label>
        </div>
        <button type="button" class="test-provider-btn" data-provider="openai">测试 OpenAI 连接</button>
      </div>

      <!-- Anthropic Claude 配置 -->
      <div id="config-anthropic" class="provider-config" style="display: none;">
        <h3>Anthropic Claude 配置</h3>
        <div class="form-group">
          <label for="anthropic-api-key">Claude API Key</label>
          <div class="password-wrapper">
            <input type="password" id="anthropic-api-key" placeholder="sk-ant-...">
            <button type="button" class="toggle-visibility-btn" data-target="anthropic-api-key">显示</button>
          </div>
          <small>获取API Key: <a href="https://console.anthropic.com/account/keys" target="_blank">Anthropic Console</a></small>
        </div>
        <div class="form-group">
          <label for="anthropic-model-name">模型名称</label>
          <input type="text" id="anthropic-model-name" placeholder="输入模型名称，如：claude-3-5-sonnet-20241022">
          <small>常用模型：claude-3-5-sonnet-20241022, claude-3-5-haiku-20241022, claude-3-opus-20240229</small>
        </div>
        <div class="form-group">
          <label for="anthropic-api-url">API 请求路径</label>
          <input type="text" id="anthropic-api-url" placeholder="输入API基础路径">
          <small>默认：https://api.anthropic.com/v1/messages</small>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" id="anthropic-enabled"> 启用Anthropic Claude
          </label>
        </div>
        <button type="button" class="test-provider-btn" data-provider="anthropic">测试 Claude 连接</button>
      </div>

      <div class="form-group">
        <button id="test-all-btn" type="button">测试所有已配置的供应商</button>
        <p id="ai-status"></p>
      </div>
    </section>

    <section id="prompt-config">
      <h2>Prompt 配置</h2>
      <div class="form-group">
        <label for="custom-prompt">自定义 Prompt</label>
        <textarea id="custom-prompt" rows="5" placeholder="留空则使用默认Prompt"></textarea>
      </div>
      <button id="reset-prompt-btn">恢复默认</button>
    </section>

    <section id="anki-config">
      <h2>AnkiConnect 配置</h2>
      <button id="test-anki-btn">测试 Anki 连接</button>
      <p id="anki-status"></p>
      
      <div class="form-group">
        <label for="default-deck">默认牌组</label>
        <select id="default-deck">
          <option value="">请先测试 Anki 连接</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="default-model">默认模板</label>
        <select id="default-model">
          <option value="">请先测试 Anki 连接</option>
        </select>
      </div>
      
      <div id="field-mapping" class="form-group" style="display: none;">
        <h3>字段映射</h3>
        <div class="field-mapping-container">
          <!-- 动态生成的字段映射选项将插入这里 -->
        </div>
      </div>
      
      <button id="refresh-anki-data" style="display: none;">刷新 Anki 数据</button>
    </section>

    <section id="system-config">
        <h2>系统设置</h2>
        <div class="form-group">
            <label for="language-select">语言</label>
            <select id="language-select">
                <option value="zh-CN">简体中文</option>
                <!-- 预留其他语言 -->
            </select>
        </div>
    </section>

    <section id="style-config">
        <h2>显示样式</h2>
        <div class="form-group">
            <label for="font-size-select">字号大小</label>
            <select id="font-size-select">
                <option value="12px">小 (12px)</option>
                <option value="14px">中 (14px)</option>
                <option value="16px">大 (16px)</option>
                <option value="18px">特大 (18px)</option>
            </select>
        </div>
        <div class="form-group">
            <label for="text-align-select">文本对齐</label>
            <select id="text-align-select">
                <option value="left">居左</option>
                <option value="center">居中</option>
                <option value="right">居右</option>
            </select>
        </div>
        <div class="form-group">
            <label for="line-height-select">行高</label>
            <select id="line-height-select">
                <option value="1.2">紧凑 (1.2)</option>
                <option value="1.4">标准 (1.4)</option>
                <option value="1.6">宽松 (1.6)</option>
            </select>
        </div>
        <div class="form-group">
            <label>样式预览</label>
            <div id="style-preview" style="border: 1px solid #ccc; padding: 10px; margin-top: 5px; background-color: #f9f9f9;">
                <div id="preview-content">这是一个示例文本<br>用于预览样式效果</div>
            </div>
        </div>
    </section>

    <footer>
      <button id="save-btn">保存配置</button>
      <p id="save-status"></p>
    </footer>
  </div>
  <script type="module" src="options.js"></script>
</body>
</html>
