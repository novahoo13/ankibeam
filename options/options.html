<!DOCTYPE html>
<!--
  Anki单词助手 - 设置页面 (Options Page)
  功能说明：
  - 配置AI服务提供商（Google Gemini、OpenAI GPT、Anthropic Claude）
  - 自定义Prompt模板和字段配置
  - 设置Anki连接和卡片模板
  - 系统设置（语言、配置导入导出）
  - 界面样式自定义（字体大小、对齐、行高）

  技术特点：
  - 多标签页界面设计，便于功能分类管理
  - 响应式布局，适配不同屏幕尺寸
  - CSS动画效果提升用户体验
  - 表单验证和实时反馈
  - 配置数据持久化存储
-->
<html lang="zh-CN">
  <!-- 设置页面语言为简体中文 -->
  <head>
    <meta charset="UTF-8" />
    <!-- UTF-8编码支持中文显示 -->
    <title>设置</title>
    <!-- Chrome扩展设置页面标题 -->
    <!-- Tailwind CSS框架 - 提供丰富的实用CSS类 -->
    <link rel="stylesheet" href="../styles/tailwind.min.css" />
    <!-- 自定义CSS样式 - 扩展和覆盖默认样式 -->
    <link rel="stylesheet" href="../styles/custom-classes.css" />
    <!-- 视口设置 - 支持响应式布局在移动设备上 -->
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!--
      内嵌CSS样式定义
      主要用于标签页切换动画和交互效果
    -->
    <style>
      /* 标签内容切换样式定义 */
      .tab-content {
        display: none; /* 默认隐藏所有标签内容 */
        animation: fadeIn 0.3s ease-in-out; /* 显示时的渐入动画效果 */
      }
      .tab-content.active {
        display: block; /* 激活状态时显示内容 */
      }

      /* 渐入动画定义 - 提供平滑的内容切换效果 */
      @keyframes fadeIn {
        from {
          opacity: 0; /* 从完全透明开始 */
          transform: translateY(10px); /* 从向下10px位置开始 */
        }
        to {
          opacity: 1; /* 到完全不透明 */
          transform: translateY(0); /* 到原始位置 */
        }
      }

      /* 标签按钮样式优化 */
      .settings-tab-btn {
        position: relative; /* 相对定位，用于伪元素定位 */
        transition: all 0.2s ease-in-out; /* 所有样式变化的过渡效果 */
      }

      /* 按钮获得焦点时的可访问性样式 */
      .settings-tab-btn:focus {
        outline: none; /* 移除浏览器默认的焦点轮廓 */
        box-shadow: 0 0 0 2px rgba(71, 85, 105, 0.2); /* 自定义焦点阴影效果 */
      }

      /* 激活标签按钮的样式 */
      .settings-tab-btn.active {
        background-color: rgb(248, 250, 252); /* 浅灰色背景 */
        color: rgb(71, 85, 105); /* 深灰色文字 */
        border-bottom-color: rgb(71, 85, 105); /* 底部边框高亮 */
      }
    </style>
  </head>
  <body>
    <!--
      页面主容器
      - min-h-screen: 最小高度为屏幕高度，确保内容充满屏幕
      - bg-gray-50: 浅灰色背景，提供柔和的视觉效果
    -->
    <div class="min-h-screen bg-gray-50">
      <!--
        内容区域容器
        - container mx-auto: 居中对齐的响应式容器
        - px-4 py-8: 水平和垂直内边距
        - max-w-2xl: 限制最大宽度为672px，保证阅读体验
      -->
      <div class="container mx-auto px-4 py-8 max-w-2xl">
        <!--
          主内容卡片
          - bg-white: 白色背景，与页面背景形成对比
          - rounded-lg: 大圆角，现代化设计风格
          - shadow-md: 中等阴影效果，增加层次感
          - p-6: 24px内边距，确保内容与边界有适当间距
        -->
        <div class="bg-white rounded-lg shadow-md p-6">
          <!--
            页面主标题
            - text-3xl font-bold: 大号字体和粗体，突出页面主题
            - text-gray-900: 深灰色文字，高对比度
            - mb-8 text-center: 底部外边距和居中对齐
          -->
          <h1 class="text-3xl font-bold text-gray-900 mb-8 text-center">
            设置中心
          </h1>

          <!--
            标签页导航栏
            包含5个主要功能区域的导航按钮
            - flex space-x-1: 水平布局，按钮间间4px间距
            - mb-6: 底部外边距24px
            - border-b border-gray-200: 底部边框分割线
            - role="tablist": 可访问性属性，标识为标签列表
          -->
          <nav
            class="flex space-x-1 mb-6 border-b border-gray-200"
            role="tablist"
          >
            <!--
              AI配置标签按钮 - 默认激活状态
              功能：配置Google Gemini、OpenAI GPT、Anthropic Claude三种 AI服务
              - role="tab": 可访问性属性，标识为标签
              - aria-selected="true": 默认选中状态
              - data-tab="ai-config": JavaScript事件处理标识符
              - active类: 激活状态样式
            -->
            <button
              role="tab"
              aria-selected="true"
              aria-controls="ai-config-panel"
              class="settings-tab-btn flex items-center px-3 py-2 text-xs font-medium text-slate-600 bg-slate-50 border-b-2 border-slate-500 hover:bg-slate-100 transition-colors duration-200 active"
              data-tab="ai-config"
            >
              <!-- AI电灯SVG图标 - 表示AI智能功能 -->
              <svg
                class="w-3 h-3 mr-1"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"
                ></path>
              </svg>
              AI 配置
            </button>
            <!--
              Prompt配置标签按钮
              功能：自定义AI Prompt模板和字段配置
              - 用户可以根据不同的Anki模板自定义Prompt
              - 支持字段映射和动态配置
            -->
            <button
              role="tab"
              aria-selected="false"
              aria-controls="prompt-config-panel"
              class="settings-tab-btn flex items-center px-3 py-2 text-xs font-medium text-gray-500 hover:text-gray-700 hover:bg-gray-50 border-b-2 border-transparent hover:border-gray-300 transition-colors duration-200"
              data-tab="prompt-config"
            >
              <!-- 编辑SVG图标 - 表示Prompt编辑功能 -->
              <svg
                class="w-3 h-3 mr-1"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
                ></path>
              </svg>
              Prompt 配置
            </button>
            <!--
              Anki连接标签按钮
              功能：AnkiConnect配置和卡片模板管理
              - 测试Anki桌面版连接状态
              - 选择默认牌组和卡片模板
              - 显示可用的字段信息
            -->
            <button
              role="tab"
              aria-selected="false"
              aria-controls="anki-config-panel"
              class="settings-tab-btn flex items-center px-3 py-2 text-xs font-medium text-gray-500 hover:text-gray-700 hover:bg-gray-50 border-b-2 border-transparent hover:border-gray-300 transition-colors duration-200"
              data-tab="anki-config"
            >
              <!-- 书本SVG图标 - 表示Anki学习卡片功能 -->
              <svg
                class="w-3 h-3 mr-1"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"
                ></path>
              </svg>
              Anki 连接
            </button>
            <!--
              系统设置标签按钮
              功能：通用系统参数配置
              - 语言设置（目前仅支持简体中文）
              - 配置数据导入/导出/重置功能
              - 系统级别的设置选项
            -->
            <button
              role="tab"
              aria-selected="false"
              aria-controls="system-config-panel"
              class="settings-tab-btn flex items-center px-3 py-2 text-xs font-medium text-gray-500 hover:text-gray-700 hover:bg-gray-50 border-b-2 border-transparent hover:border-gray-300 transition-colors duration-200"
              data-tab="system-config"
            >
              <!-- 齿轮SVG图标 - 表示系统配置功能 -->
              <svg
                class="w-3 h-3 mr-1"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"
                ></path>
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                ></path>
              </svg>
              系统设置
            </button>
            <!--
              样式设置标签按钮
              功能：界面显示样式自定义
              - 字体大小设置（12px-18px）
              - 文本对齐方式（左对齐/居中/右对齐）
              - 行高设置（1.2-1.6）
              - 实时预览效果
            -->
            <button
              role="tab"
              aria-selected="false"
              aria-controls="style-config-panel"
              class="settings-tab-btn flex items-center px-3 py-2 text-xs font-medium text-gray-500 hover:text-gray-700 hover:bg-gray-50 border-b-2 border-transparent hover:border-gray-300 transition-colors duration-200"
              data-tab="style-config"
            >
              <!-- 板式SVG图标 - 表示样式设计功能 -->
              <svg
                class="w-3 h-3 mr-1"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v12a4 4 0 004 4h4a2 2 0 002-2V5z"
                ></path>
              </svg>
              样式设置
            </button>
          </nav>

          <!--
            标签页内容容器
            包含所有标签面板的实际内容
            JavaScript通过切换CSS类来控制显示/隐藏状态
          -->
          <div class="settings-tab-content">
            <!--
              AI配置面板 - 默认激活状态
              功能说明：
              1. AI服务提供商选择和切换
              2. 各提供商的API Key配置
              3. 模型名称和API地址自定义
              4. 连接测试和状态显示
              - active类: 默认显示该面板
              - role="tabpanel": 可访问性标识
            -->
            <div
              id="ai-config"
              class="tab-content active"
              role="tabpanel"
              aria-labelledby="ai-config-tab"
            >
              <div class="space-y-6">
                <!-- 子元素间垂直间距24px -->
                <!--
                  AI提供商选择下拉框
                  用户可以在Google Gemini、OpenAI GPT、Anthropic Claude之间切换
                  JavaScript监听此下拉框的变化事件，动态显示/隐藏对应配置区域
                -->
                <div class="mb-6">
                  <label
                    for="ai-provider"
                    class="block text-sm font-medium text-gray-700 mb-2"
                    >选择 AI 提供商</label
                  >
                  <select
                    id="ai-provider"
                    class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-slate-500"
                  >
                    <option value="google">Google (Gemini)</option>
                    <option value="openai">OpenAI (GPT)</option>
                    <option value="anthropic">Anthropic (Claude)</option>
                  </select>
                </div>

                <!--
                  Google Gemini配置区域
                  功能：
                  - Gemini API Key输入和显示/隐藏切换
                  - 模型名称配置（支持gemini-2.5系列）
                  - API地址自定义（支持代理服务器）
                  - 连接测试和状态反馈
                  - 默认显示，其他提供商配置默认隐藏
                -->
                <div
                  id="config-google"
                  class="provider-config bg-slate-50 border border-slate-200 rounded-md p-6 mb-6"
                >
                  <!--
                    Google Gemini API Key配置区域
                    - type="password": 密码型输入框，默认隐藏内容
                    - toggle-visibility-btn: 显示/隐藏切换按钮
                    - data-target: JavaScript事件处理目标元素标识
                    - 提供官方API Key获取链接
                  -->
                  <div class="mb-4">
                    <label
                      for="google-api-key"
                      class="block text-sm font-medium text-gray-700 mb-2"
                      >Gemini API Key</label
                    >
                    <div class="flex gap-2">
                      <!-- API Key输入框和显示按钮并排 -->
                      <input
                        type="password"
                        id="google-api-key"
                        placeholder="输入 Gemini API Key"
                        class="flex-1 p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-slate-500"
                      />
                      <!-- API Key可见性切换按钮 -->
                      <button
                        type="button"
                        class="toggle-visibility-btn bg-gray-200 hover:bg-gray-300 px-3 py-2 rounded-md transition"
                        data-target="google-api-key"
                      >
                        显示
                      </button>
                    </div>
                    <!-- 帮助链接 - 引导用户获取API Key -->
                    <small class="text-xs text-gray-500 mt-1 block"
                      >获取 API Key：<a
                        href="https://makersuite.google.com/app/apikey"
                        target="_blank"
                        class="text-slate-600 hover:underline"
                        >Google AI Studio</a
                      ></small
                    >
                  </div>
                  <!--
                    Google Gemini模型名称配置
                    支持用户自定义使用的Gemini模型
                    - 常用模型包括：gemini-2.5-pro、gemini-2.5-flash等
                    - 支持最新的Gemini 2.5系列模型
                  -->
                  <div class="mb-4">
                    <label
                      for="google-model-name"
                      class="block text-sm font-medium text-gray-700 mb-2"
                      >模型名称</label
                    >
                    <input
                      type="text"
                      id="google-model-name"
                      placeholder="例如：gemini-2.5-flash-lite"
                      class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-slate-500"
                    />
                    <!-- 模型推荐提示 -->
                    <small class="text-xs text-gray-500 mt-1 block"
                      >常用模型：gemini-2.5-pro、gemini-2.5-flash、gemini-2.5-flash-lite</small
                    >
                  </div>
                  <!--
                    Google Gemini API地址配置
                    支持自定义API地址，便于使用代理服务或中转服务
                    - 默认使用Google官方API地址
                    - 支持第三方代理服务（如国内代理）
                  -->
                  <div class="mb-4">
                    <label
                      for="google-api-url"
                      class="block text-sm font-medium text-gray-700 mb-2"
                      >API 地址</label
                    >
                    <input
                      type="text"
                      id="google-api-url"
                      placeholder="例如：https://generativelanguage.googleapis.com/v1beta/models"
                      class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-slate-500"
                    />
                    <!-- API地址默认值提示 -->
                    <small class="text-xs text-gray-500 mt-1 block"
                      >默认：https://generativelanguage.googleapis.com/v1beta/models</small
                    >
                  </div>
                  <!--
                    Google Gemini连接测试区域
                    - test-provider-btn: 测试按钮，验证API Key和连接有效性
                    - data-provider="google": JavaScript事件处理标识符
                    - ai-status-google: 状态显示区域，显示测试结果
                  -->
                  <div class="flex items-center gap-4">
                    <!-- 连接测试按钮 -->
                    <button
                      type="button"
                      class="test-provider-btn bg-slate-600 hover:bg-slate-700 text-white font-medium py-2 px-4 rounded-md transition"
                      data-provider="google"
                    >
                      测试 Gemini 连接
                    </button>
                    <!-- 状态信息显示区域 - JavaScript动态更新 -->
                    <div
                      id="ai-status-google"
                      class="text-sm text-gray-600 flex-1"
                    ></div>
                  </div>
                </div>

                <!--
                  OpenAI GPT配置区域
                  功能：
                  - OpenAI API Key配置（sk-开头的官方密钥）
                  - GPT模型选择（gpt-4o、gpt-4o-mini等）
                  - API地址自定义支持
                  - 连接测试和状态反馈
                  - 默认隐藏，JavaScript根据用户选择显示
                -->
                <!-- OpenAI配置区域 - 默认隐藏，选择OpenAI时显示 -->
                <div
                  id="config-openai"
                  class="provider-config bg-slate-50 border border-slate-200 rounded-md p-6 mb-6"
                  style="display: none"
                >
                  <div class="mb-4">
                    <label
                      for="openai-api-key"
                      class="block text-sm font-medium text-gray-700 mb-2"
                      >OpenAI API Key</label
                    >
                    <input
                      type="password"
                      id="openai-api-key"
                      placeholder="sk-..."
                      class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-slate-500"
                    />
                    <small class="text-xs text-gray-500 mt-1 block"
                      >获取 API Key：<a
                        href="https://platform.openai.com/api-keys"
                        target="_blank"
                        class="text-slate-600 hover:underline"
                        >OpenAI Platform</a
                      ></small
                    >
                  </div>
                  <div class="mb-4">
                    <label
                      for="openai-model-name"
                      class="block text-sm font-medium text-gray-700 mb-2"
                      >模型名称</label
                    >
                    <input
                      type="text"
                      id="openai-model-name"
                      placeholder="例如：gpt-4o-mini"
                      class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-slate-500"
                    />
                    <small class="text-xs text-gray-500 mt-1 block"
                      >常用模型：gpt-4o、gpt-4o-mini、gpt-4-turbo、gpt-5</small
                    >
                  </div>
                  <div class="mb-4">
                    <label
                      for="openai-api-url"
                      class="block text-sm font-medium text-gray-700 mb-2"
                      >API 地址</label
                    >
                    <input
                      type="text"
                      id="openai-api-url"
                      placeholder="例如：https://api.openai.com/v1"
                      class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-slate-500"
                    />
                    <small class="text-xs text-gray-500 mt-1 block"
                      >默认：https://api.openai.com/v1</small
                    >
                  </div>
                  <div class="flex items-center gap-4">
                    <button
                      type="button"
                      class="test-provider-btn bg-slate-600 hover:bg-slate-700 text-white font-medium py-2 px-4 rounded-md transition"
                      data-provider="openai"
                    >
                      测试 GPT 连接
                    </button>
                    <div
                      id="ai-status-openai"
                      class="text-sm text-gray-600 flex-1"
                    ></div>
                  </div>
                </div>

                <!--
                  Anthropic Claude配置区域
                  功能：
                  - Anthropic API Key配置
                  - Claude模型选择（claude-3-7-sonnet、claude-sonnet-4等）
                  - API地址自定义支持
                  - 连接测试和状态反馈
                  - 默认隐藏，选择Anthropic时显示
                -->
                <!-- Anthropic配置区域 - 默认隐藏，选择Anthropic时显示 -->
                <div
                  id="config-anthropic"
                  class="provider-config bg-slate-50 border border-slate-200 rounded-md p-6 mb-6"
                  style="display: none"
                >
                  <div class="mb-4">
                    <label
                      for="anthropic-api-key"
                      class="block text-sm font-medium text-gray-700 mb-2"
                      >Anthropic API Key</label
                    >
                    <input
                      type="password"
                      id="anthropic-api-key"
                      placeholder="输入 API Key"
                      class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-slate-500"
                    />
                    <small class="text-xs text-gray-500 mt-1 block"
                      >获取 API Key：<a
                        href="https://console.anthropic.com/settings/keys"
                        target="_blank"
                        class="text-slate-600 hover:underline"
                        >Anthropic Console</a
                      ></small
                    >
                  </div>
                  <div class="mb-4">
                    <label
                      for="anthropic-model-name"
                      class="block text-sm font-medium text-gray-700 mb-2"
                      >模型名称</label
                    >
                    <input
                      type="text"
                      id="anthropic-model-name"
                      placeholder="例如：claude-3-7-sonnet-all"
                      class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-slate-500"
                    />
                    <small class="text-xs text-gray-500 mt-1 block"
                      >常用模型：claude-3-7-sonnet-all、claude-sonnet-4-all、claude-opus-4-all</small
                    >
                  </div>
                  <div class="mb-4">
                    <label
                      for="anthropic-api-url"
                      class="block text-sm font-medium text-gray-700 mb-2"
                      >API 地址</label
                    >
                    <input
                      type="text"
                      id="anthropic-api-url"
                      placeholder="例如：https://api.anthropic.com/v1/messages"
                      class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-slate-500"
                    />
                    <small class="text-xs text-gray-500 mt-1 block"
                      >默认：https://api.anthropic.com/v1/messages</small
                    >
                  </div>
                  <div class="flex items-center gap-4">
                    <button
                      type="button"
                      class="test-provider-btn bg-slate-600 hover:bg-slate-700 text-white font-medium py-2 px-4 rounded-md transition"
                      data-provider="anthropic"
                    >
                      测试 Claude 连接
                    </button>
                    <div
                      id="ai-status-anthropic"
                      class="text-sm text-gray-600 flex-1"
                    ></div>
                  </div>
                </div>
              </div>
            </div>

            <!--
              Prompt配置面板
              功能说明：
              1. 按Anki模板配置AI Prompt
              2. 字段选择和配置
              3. 自定义Prompt模板编辑
              4. 支持动态字段映射
              5. 模板重置和修改状态追踪
              - 默认隐藏，点击标签显示
            -->
            <div
              id="prompt-config"
              class="tab-content"
              role="tabpanel"
              aria-labelledby="prompt-config-tab"
            >
              <div class="space-y-8">
                <!-- 子区域间垂直间距32px -->
                <!--
                  Prompt配置编辑器主区域
                  提供可视化的Prompt编辑界面
                  - shadow-sm: 轻微阴影效果
                  - prompt-config-editor: 自定义CSS类标识符
                -->
                <section
                  class="bg-slate-50 border border-slate-200 rounded-md p-5 shadow-sm prompt-config-editor"
                >
                  <!--
                    Prompt配置头部信息
                    - 响应式布局：桌面端水平排列，移动端垂直排列
                    - 显示当前选中的Anki模板名称
                    - 提供操作指导信息
                  -->
                  <div
                    class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-4"
                  >
                    <div>
                      <h3 class="text-lg font-semibold text-gray-800">
                        按模板配置 Prompt
                      </h3>
                      <!-- 操作提示信息 -->
                      <p id="prompt-model-hint" class="text-sm text-gray-600">
                        请在「Anki 连接」面板选择要编辑的模型，随后在这里自定义
                        Prompt。
                      </p>
                    </div>
                    <!-- 当前模板状态显示 -->
                    <span
                      id="prompt-current-model"
                      class="text-sm text-slate-600 bg-white border border-slate-200 rounded-md px-3 py-1"
                      >当前模板：未选择</span
                    >
                  </div>

                  <!--
                    字段配置编辑区域
                    功能：
                    1. 字段选择：显示当前模板的所有字段，支持多选
                    2. 字段配置：为每个字段配置Prompt描述
                    3. 状态显示：实时显示配置状态和验证结果
                    - 默认隐藏，选择模板后显示
                  -->
                  <!-- 字段配置编辑区域 - 初始状态隐藏 -->
                  <div
                    id="prompt-field-editor"
                    class="bg-white border border-slate-200 rounded-md p-4 space-y-4"
                    style="display: none"
                  >
                    <!--
                      字段选择区域
                      用户可以选择哪些字段需要AI生成内容
                    -->
                    <div>
                      <div class="flex items-center justify-between">
                        <h4 class="text-sm font-medium text-gray-700">
                          字段选择
                        </h4>
                        <!-- 操作提示 -->
                        <span class="text-xs text-gray-500"
                          >点击字段切换选中状态</span
                        >
                      </div>
                      <!-- 字段选择按钮列表 - JavaScript动态生成 -->
                      <div
                        id="field-selection-list"
                        class="flex flex-wrap gap-2 mt-3"
                      ></div>
                    </div>
                    <!--
                      字段配置区域
                      为每个选中的字段配置生成描述
                    -->
                    <div>
                      <div class="flex items-center justify-between">
                        <h4 class="text-sm font-medium text-gray-700">
                          字段配置
                        </h4>
                        <!-- 功能说明 -->
                        <span class="text-xs text-gray-500"
                          >配置生成 AI 输出该字段所需的信息</span
                        >
                      </div>
                      <!-- 字段配置表单列表 - JavaScript动态生成 -->
                      <div id="field-config-list" class="mt-3 space-y-4"></div>
                    </div>
                    <!-- 配置状态信息 -->
                    <p
                      id="prompt-config-status"
                      class="text-xs text-gray-500"
                    ></p>
                  </div>

                  <!--
                    自定义Prompt模板编辑区域
                    功能：
                    - 大型文本区域编辑Prompt内容
                    - font-mono: 等宽字体，便于代码和模板编辑
                    - 支持占位符语法（{{INPUT_TEXT}}、{{FIELD_SCHEMA}}）
                    - 初始状态禁用，选择模板后启用
                  -->
                  <div class="form-group mt-4">
                    <label
                      for="custom-prompt-textarea"
                      class="block text-sm font-medium text-gray-700 mb-2"
                      >自定义 Prompt 模板</label
                    >
                    <!-- Prompt模板编辑文本区域 - 12行高度，提供足够的编辑空间 -->
                    <textarea
                      id="custom-prompt-textarea"
                      rows="12"
                      class="w-full p-3 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-slate-500 font-mono text-sm"
                      placeholder="请选择模型后编写对应的 Prompt。
建议包含以下占位符：
- {{INPUT_TEXT}} 表示用户输入
- {{FIELD_SCHEMA}} 表示字段结构"
                      disabled <!-- 初始禁用状态 -->
                    ></textarea
                    >
                  </div>

                  <!--
                    Prompt模板操作按钮区域
                    - reset-prompt-btn: 重置按钮，恢复到默认模板
                    - prompt-dirty-flag: 修改状态标识，提醒用户保存
                  -->
                  <div class="flex items-center gap-3 mt-3">
                    <!-- 重置模板按钮 -->
                    <button
                      type="button"
                      id="reset-prompt-btn"
                      class="bg-slate-500 hover:bg-slate-600 text-white font-medium py-2 px-4 rounded-md transition disabled:opacity-50"
                      disabled
                    >
                      重置为默认模板
                    </button>
                    <!-- 修改状态提示 - 默认隐藏 -->
                    <span
                      id="prompt-dirty-flag"
                      class="text-xs text-slate-500"
                      style="display: none"
                      >已修改，保存后生效</span
                    >
                  </div>
                </section>
              </div>
            </div>
            <!--
              Anki连接配置面板
              功能说明：
              1. AnkiConnect连接测试和状态检查
              2. 牌组选择和管理
              3. Anki模板选择和配置
              4. 字段信息显示和映射
              5. 实时同步Anki数据
              - 默认隐藏，点击标签显示
            -->
            <div
              id="anki-config"
              class="tab-content"
              role="tabpanel"
              aria-labelledby="anki-config-tab"
            >
              <div class="space-y-6">
                <!-- 区域间垂直间距24px -->
                <!--
                  Anki连接测试区域
                  - 检测AnkiConnect是否正常运行
                  - 自动获取可用的牌组和模板列表
                  - 实时显示连接状态和错误信息
                -->
                <div class="mb-4">
                  <div class="flex items-center gap-4">
                    <!-- AnkiConnect连接测试按钮 -->
                    <button
                      id="test-anki-btn"
                      class="bg-slate-600 hover:bg-slate-700 text-white font-medium py-2 px-4 rounded-md transition"
                    >
                      测试连接并刷新模型
                    </button>
                    <!-- Anki连接状态显示区域 -->
                    <p
                      id="anki-status"
                      class="text-sm text-gray-600 flex-1"
                    ></p>
                  </div>
                </div>

                <!--
                  牌组和模板选择区域
                  - 响应式网格布局：桌面端2列，移动端1列
                  - 牌组：Anki中的学习卡片集合
                  - 模板：定义卡片的字段结构和样式
                -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                  <!-- 默认牌组选择 -->
                  <div>
                    <label
                      for="default-deck"
                      class="block text-sm font-medium text-gray-700 mb-2"
                      >牌组</label
                    >
                    <!-- 牌组下拉选择框 - JavaScript动态填充 -->
                    <select
                      id="default-deck"
                      class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-slate-500"
                    >
                      <option value="">请先测试 Anki 连接</option>
                    </select>
                  </div>

                  <!-- Anki模板选择 -->
                  <div>
                    <label
                      for="default-model"
                      class="block text-sm font-medium text-gray-700 mb-2"
                      >模型</label
                    >
                    <!-- 模板下拉选择框 - JavaScript动态填充 -->
                    <select
                      id="default-model"
                      class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-slate-500"
                    >
                      <option value="">请先测试 Anki 连接</option>
                    </select>
                  </div>
                </div>

                <!--
                  字段映射信息显示区域
                  功能：
                  - 显示当前选中模板的所有字段
                  - 字段类型和属性信息显示
                  - 为Prompt配置提供参考信息
                  - 默认隐藏，选择模板后显示
                -->
                <div id="field-mapping" class="mb-4" style="display: none">
                  <h3 class="text-lg font-semibold text-gray-700 mb-3">
                    字段信息
                  </h3>
                  <!--
                    字段列表容器
                    - JavaScript动态生成字段信息卡片
                    - 显示字段名称、类型、是否必填等信息
                  -->
                  <div
                    class="field-mapping-container bg-gray-50 border border-gray-200 rounded-md p-4"
                  >
                    <!-- 运行时由JavaScript动态填入字段列表 -->
                  </div>
                </div>
              </div>
            </div>

            <!--
              系统配置面板
              功能说明：
              1. 多语言设置（目前仅支持中文）
              2. 配置数据导入/导出功能
              3. 系统设置重置功能
              4. 数据备份和恢复
              - 默认隐藏，点击标签显示
            -->
            <div
              id="system-config"
              class="tab-content"
              role="tabpanel"
              aria-labelledby="system-config-tab"
            >
              <div class="space-y-6">
                <!-- 区域间垂直间距24px -->
                <!--
                  语言设置区域
                  - 目前仅支持简体中文
                  - 预留多语言功能扩展接口
                  - 未来可能支持英文、日语等
                -->
                <div class="mb-4">
                  <label
                    for="language-select"
                    class="block text-sm font-medium text-gray-700 mb-2"
                    >语言</label
                  >
                  <!-- 语言选择下拉框 -->
                  <select
                    id="language-select"
                    class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-slate-500"
                  >
                    <option value="zh-CN">简体中文</option>
                  </select>
                </div>

                <!--
                  配置管理区域
                  功能说明：
                  1. 导出配置：将当前设置保存为JSON文件
                  2. 导入配置：从文件恢复之前的设置
                  3. 重置配置：清除所有设置，恢复到默认状态
                  安全特性：导出时自动过滤API密钥等敏感信息
                -->
                <section
                  class="p-6 bg-gray-50 border border-gray-200 rounded-md"
                >
                  <h3 class="text-lg font-semibold text-gray-800 mb-4">
                    配置管理
                  </h3>
                  <!-- 功能说明和安全提示 -->
                  <p class="text-sm text-gray-600 mb-4">
                    导出、导入或重置您的配置设置。注意：导出的配置文件不包含API密钥以确保安全。
                  </p>

                  <!--
                    配置管理操作按钮组
                    - 响应式布局：小屏幕垂直排列，大屏幕水平排列
                    - 按钮颜色区分：蓝色导出、绿色导入、红色重置
                  -->
                  <div class="flex flex-col sm:flex-row gap-3">
                    <!-- 配置导出按钮 -->
                    <button
                      type="button"
                      id="export-config-btn"
                      class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition duration-200"
                    >
                      📤 导出配置
                    </button>

                    <!-- 配置导入区域 -->
                    <div class="flex items-center">
                      <!-- 隐藏的文件选择输入框 -->
                      <!-- 隐藏的文件输入框 - 仅接受JSON格式文件 -->
                      <input
                        type="file"
                        id="import-config-input"
                        accept=".json"
                        class="hidden"
                      />
                      <!-- 配置导入触发按钮 -->
                      <button
                        type="button"
                        id="import-config-btn"
                        class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md transition duration-200"
                      >
                        📥 导入配置
                      </button>
                    </div>

                    <!-- 配置重置按钮 - 需要二次确认 -->
                    <button
                      type="button"
                      id="reset-config-btn"
                      class="bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded-md transition duration-200"
                    >
                      🔄 重置配置
                    </button>
                  </div>

                  <!-- 配置管理操作状态显示 -->
                  <div class="mt-3">
                    <p
                      id="config-management-status"
                      class="text-sm text-gray-600"
                    ></p>
                  </div>
                </section>
              </div>
            </div>

            <!--
              样式配置面板
              功能说明：
              1. 字体大小调整（12px-18px选项）
              2. 文本对齐方式（左对齐/居中/右对齐）
              3. 行高设置（1.2-1.6范围）
              4. 实时预览效果
              5. 应用到弹窗界面的样式设置
              - 默认隐藏，点击标签显示
            -->
            <div
              id="style-config"
              class="tab-content"
              role="tabpanel"
              aria-labelledby="style-config-tab"
            >
              <div class="space-y-6">
                <!-- 区域间垂直间距24px -->
                <!--
                  样式设置控制面板
                  - 3列响应式网格布局：桌面端3列，平板和手机1列
                  - 每个设置项都提供直观的选项和说明
                -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                  <!-- 字体大小设置 -->
                  <div>
                    <label
                      for="font-size-select"
                      class="block text-sm font-medium text-gray-700 mb-2"
                      >字体大小</label
                    >
                    <select
                      id="font-size-select"
                      class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-slate-500"
                    >
                      <option value="12px">小 (12px)</option>
                      <option value="14px">中 (14px)</option>
                      <option value="16px">大 (16px)</option>
                      <option value="18px">更大 (18px)</option>
                    </select>
                  </div>
                  <!-- 文本对齐设置 -->
                  <div>
                    <label
                      for="text-align-select"
                      class="block text-sm font-medium text-gray-700 mb-2"
                      >文本对齐</label
                    >
                    <select
                      id="text-align-select"
                      class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-slate-500"
                    >
                      <option value="left">左对齐</option>
                      <option value="center">居中</option>
                      <option value="right">右对齐</option>
                    </select>
                  </div>
                  <!-- 行高设置 -->
                  <div>
                    <label
                      for="line-height-select"
                      class="block text-sm font-medium text-gray-700 mb-2"
                      >行高</label
                    >
                    <select
                      id="line-height-select"
                      class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-slate-500"
                    >
                      <option value="1.2">紧凑 (1.2)</option>
                      <option value="1.4">适中 (1.4)</option>
                      <option value="1.6">宽松 (1.6)</option>
                    </select>
                  </div>
                </div>
                <!--
                  样式预览区域
                  功能：
                  - 实时显示字体大小、对齐、行高的效果
                  - 用户可以直观看到设置变化对文本的影响
                  - JavaScript实时更新预览效果
                -->
                <div class="mb-4">
                  <label class="block text-sm font-medium text-gray-700 mb-2"
                    >样式预览</label
                  >
                  <!-- 预览效果显示区域 -->
                  <div
                    id="style-preview"
                    class="border border-gray-300 rounded-md p-4 bg-gray-50"
                  >
                    <!-- 示例文本内容 - JavaScript实时应用样式 -->
                    <div id="preview-content">
                      这是一个示例文本。<br />用于预览字体、对齐与行高效果。
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!--
            页面底部区域
            - 全局保存按钮和状态显示
            - border-t: 顶部边框分隔线
            - mt-8 pt-6: 顶部外边距和内边距
            - 响应式布局：手机端全宽，桌面端自适应宽度
          -->
          <footer class="mt-8 pt-6 border-t border-gray-200">
            <div class="flex flex-col items-center space-y-3">
              <!--
                全局保存设置按钮
                - 保存所有标签页的配置修改
                - JavaScript监听点击事件，批量保存数据
                - 保存成功后更新状态显示
              -->
              <button
                id="save-btn"
                class="bg-slate-700 hover:bg-slate-800 text-white font-semibold py-3 px-8 rounded-md transition duration-200 w-full md:w-auto"
              >
                保存设置
              </button>
              <!-- 保存状态信息显示 - JavaScript动态更新 -->
              <p id="save-status" class="text-sm text-gray-600"></p>
            </div>
          </footer>
        </div>
      </div>
    </div>

    <!--
      JavaScript模块加载
      - type="module": ES6模块支持，启用import/export语法
      - src="options.js": 设置页面的主要业务逻辑文件

      options.js文件包含的主要功能：
      1. 标签页切换逻辑和动画效果
      2. AI提供商配置和测试连接
      3. Prompt模板编辑和字段配置
      4. AnkiConnect集成和数据同步
      5. 配置数据的存储、加载、导入导出
      6. 样式设置的实时预览和应用
      7. 表单验证和用户反馈
      8. API密钥的安全处理和显示控制
    -->
    <script type="module" src="options.js"></script>
  </body>
</html>
